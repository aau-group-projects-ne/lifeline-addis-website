generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model assessment {
  id             Int       @id @default(autoincrement())
  patientId      Int
  doctorId       Int
  document       String
  estimatedPrice Float
  createdAt      DateTime  @default(now())
  doctor         user      @relation("DoctorAssessments", fields: [doctorId], references: [id])
  patient        patient   @relation("PatientAssessments", fields: [patientId], references: [id])
  payments       payment[] @relation("AssessmentPayments")
  updates        update[]  @relation("AssessmentUpdates")

  @@index([doctorId])
  @@index([patientId])
}

model assignment {
  id         Int      @id @default(autoincrement())
  patientId  Int
  nurseId    Int
  assignedAt DateTime @default(now())
  nurse      user     @relation("NurseAssignments", fields: [nurseId], references: [id])
  patient    patient  @relation("PatientAssignments", fields: [patientId], references: [id])

  @@index([nurseId])
  @@index([patientId])
}

model patient {
  id          Int          @id @default(autoincrement())
  userId      Int          @unique
  age         Int?
  sex         String?
  phoneNumber String?
  assessments assessment[] @relation("PatientAssessments")
  assignments assignment[] @relation("PatientAssignments")
  user        user         @relation("UserPatient", fields: [userId], references: [id])
  payments    payment[]    @relation("PatientPayments")
  ratings     rating[]     @relation("PatientRatings")
}

model payment {
  id           Int        @id @default(autoincrement())
  patientId    Int
  assessmentId Int
  slipUrl      String
  uploadedAt   DateTime   @default(now())
  assessment   assessment @relation("AssessmentPayments", fields: [assessmentId], references: [id])
  patient      patient    @relation("PatientPayments", fields: [patientId], references: [id])

  @@index([assessmentId])
  @@index([patientId])
}

model rating {
  id          Int      @id @default(autoincrement())
  patientId   Int
  ratedUserId Int
  score       Int
  comment     String?
  createdAt   DateTime @default(now())
  patient     patient  @relation("PatientRatings", fields: [patientId], references: [id])
  ratedUser   user     @relation("RatingsGiven", fields: [ratedUserId], references: [id])

  @@index([patientId])
  @@index([ratedUserId])
}

model update {
  id           Int        @id @default(autoincrement())
  assessmentId Int
  nurseId      Int
  statusUpdate String
  updatedAt    DateTime   @default(now())
  assessment   assessment @relation("AssessmentUpdates", fields: [assessmentId], references: [id])
  nurse        user       @relation("NurseUpdates", fields: [nurseId], references: [id])

  @@index([assessmentId])
  @@index([nurseId])
}

model user {
  id                Int          @id @default(autoincrement())
  name              String
  email             String       @unique
  password          String
  role              user_role
  doctorAssessments assessment[] @relation("DoctorAssessments")
  nurseAssignments  assignment[] @relation("NurseAssignments")
  patient           patient?     @relation("UserPatient")
  ratingsGiven      rating[]     @relation("RatingsGiven")
  nurseUpdates      update[]     @relation("NurseUpdates")
}

enum user_role {
  patient
  doctor
  nurse
  admin
}
